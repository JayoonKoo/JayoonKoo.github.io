<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"jayoonkoo.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.6.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="티끌모아 태산">
<meta property="og:url" content="https://jayoonkoo.github.io/page/3/index.html">
<meta property="og:site_name" content="티끌모아 태산">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="JayoonKoo">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://jayoonkoo.github.io/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>티끌모아 태산</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">티끌모아 태산</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">작은 조각 모음</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">18</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">14</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">144</span></a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">JayoonKoo</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">144</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/JayoonKoo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;JayoonKoo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:rnwkdbs12@gmail.com" title="E-Mail → mailto:rnwkdbs12@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/JayoonKoo" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/31/TIL/unca/211230-211230%20Redux%20%EB%B3%B4%EC%95%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/31/TIL/unca/211230-211230%20Redux%20%EB%B3%B4%EC%95%88/" class="post-title-link" itemprop="url">211230 Redux 보안</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-31 15:17:11 / Modified: 15:19:35" itemprop="dateCreated datePublished" datetime="2021-12-31T15:17:11+09:00">2021-12-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TIL/" itemprop="url" rel="index"><span itemprop="name">TIL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><h3 id="Rules-of-Reducers"><a href="#Rules-of-Reducers" class="headerlink" title="Rules of Reducers"></a>Rules of Reducers</h3><ul>
<li>state와 action을 통해서만 새로운 state가 계산되어야 함</li>
<li>state는 불변성을 지키면서 업데이트해야함.</li>
<li>순수 함수 여야 함. random이나, asycLogic 등 side effects를 발생시키지 말아야 함.</li>
</ul>
<p>이렇게 해야하는 이유? </p>
<ul>
<li>state 와 action만으로 새로운 상태가 나오기 때문에 예측하기 쉽고, test 하기 쉽다.</li>
<li>그렇지 않다면 어떻게 동작하는지 어떤 결과를 리턴하는지 알 수 없게 된다.</li>
<li>Redux가 올바르게 동작하지 못하게 하여서 bug를 유발한다.</li>
</ul>
<p>Redux Toolkit에 <code>createSlice</code> 는 내부적으로 <code>immer</code> 라이브러리를 사용하여 <code>immutable</code> 하게 업데이트 하는 작업을 편하게 해준다. <code>immer</code> 는 <code>state</code> 를 <code>Proxy</code> 객체로 감싸고 변경사항이 있을대 비교하여 <code>immutable</code> 한 <code>state</code> 를 반환할수 있게 해준다.</p>
<p>→ 내부적으로 <code>immer</code> 를 사용하는 <code>createSlice</code> 나 <code>createReducer</code> 를 사용하지 않는다면 <code>immutable</code> 하게 객체를 업데이트해야 한다.  </p>
<h3 id="Writing-Async-Logic-with-Thunks"><a href="#Writing-Async-Logic-with-Thunks" class="headerlink" title="Writing Async Logic with Thunks"></a>Writing Async Logic with Thunks</h3><p><code>RTK</code> 는 내부적으로 <code>redux-thunk</code> 를 포함한다. <code>createAsyncThunk</code> 를 사용하면 Thunk를 쉽게 생성할 수 있다. </p>
<h2 id="보안"><a href="#보안" class="headerlink" title="보안"></a>보안</h2><ul>
<li>Local Storage 정보는 XSS Attack 으로 도난 당할 수 있다.</li>
</ul>
<h3 id="XSS-Attack-이란"><a href="#XSS-Attack-이란" class="headerlink" title="XSS Attack 이란?"></a>XSS Attack 이란?</h3><p>(Cross-Site Scripting Attack) </p>
<ul>
<li>injection 관련 보안 이슈</li>
<li>사용자가 신뢰하는 웹사이트에 스크립트를 주입해서 정보를 빼내거나 의도치 않은 작업을 하는 것, 웹 어플리케이션, 통상적으로 form 안에 input을 통해서 주입한다.</li>
<li>헤커가 자바스크립트를 준비해서 웹사이트에 숨겨 놓는다.</li>
<li>사용자가 이용하다가 숨겨진 스크립트에 의해 쿠키나 localStorage에 정보를 attacker 에게 전달할수 있다.</li>
<li>민감한 정보를 localStorage에 저장하면 안됨..</li>
<li>해결 방법<ul>
<li>메모리 상의 저장 → 브라우저 나가면 로그인 유지 되지 않는다거나 사용자 경험이 떨어짐</li>
<li>쿠키를 사용하는데, http only 옵션을 넣어줌.→ 브라우저만 쿠키 정보를 읽을 수 있도록 함. 자바스크립트로 읽을 수 없게함. 만료 기간을 설정하면 만료 전까진 쿠키에 유지 됨.<ul>
<li>모바일 클라이언트엔 적용할 수 없음.</li>
<li>CSRF attack에는 취약함.</li>
</ul>
</li>
</ul>
</li>
<li>서버에서는 cors 에 creadentials를 true (Access-Control-Allow-Credentials)로 설정하고 http only로 쿠키를 보내주어야 한다.</li>
<li>헤더에 cookie로 넣어버리면? 모바일 클라이언트는 문제가 생김, 일단은 그대로 바디로 token을 넘겨주기도 하고, header로 설정하기도 해야 함.</li>
<li>서버에 auth 부분에서는 Cookie 도 확인하고 Header도 확인해야 함. 모바일 클라이언트도 있기 때문에</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/24/TIL/211223-211223%20%EB%A6%AC%EC%97%91%ED%8A%B8%20%EC%BF%BC%EB%A6%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/24/TIL/211223-211223%20%EB%A6%AC%EC%97%91%ED%8A%B8%20%EC%BF%BC%EB%A6%AC/" class="post-title-link" itemprop="url">211223 리엑트 쿼리</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-24 12:59:17 / Modified: 12:59:22" itemprop="dateCreated datePublished" datetime="2021-12-24T12:59:17+09:00">2021-12-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TIL/" itemprop="url" rel="index"><span itemprop="name">TIL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="211223"><a href="#211223" class="headerlink" title="211223"></a>211223</h1><h2 id="리엑트-쿼리"><a href="#리엑트-쿼리" class="headerlink" title="리엑트 쿼리"></a>리엑트 쿼리</h2><ul>
<li>리엑트 쿼리 : <code>useQuery</code> 데이터의 캐시 키와 Promise 를 반환하는 함수를 기반으로 데이터의 로딩 결과 오류 상태를 관리해 준다.</li>
<li>Promise 를 반환하는 함수의 매개변수를 캐시키에 포함시킨다.</li>
<li>stale time 과 cache time<ul>
<li>stale time : 신선하지 않다는 의미 → 데이터가 더이상 유효하지 않다 → 재요청 , 기본값은 0 인데 불러온 시점부터 유효하지 않게 되어서 재요청이 필요한 상태가 된다. 재용청 기회가 주어지는 시점은 똑같은 캐시 키를 사용하는 useQuery 를 사용하는 컴포넌트가 마운트될 때이다.</li>
<li>useQuery Hook을 사용하는 컴포넌트가 언마운트되고 나서 해당 데이터를 얼마 동안 유지할지에 대한 설정. 기본값은 5분이다. 그래서 만약에 컴포넌트가 언마운트 되고 5분이 안되서 다시 마운트 되었다면 isLoading이 true가 되지 않고 이전에 data 값을 사용하게 된다. 그리고 staelTime 에 따라 해당 데이터가 유효하다면 재요청 하지 않고 유효하지 않다면 재요청 한다.</li>
<li>기본 옵션의 경우 useQuery를 사용하는 어떤 컴포넌트가 마운트 되고, 처음 마운트된 컴포넌트가 5분이 되지 않은 상태에서 다른 컴포넌트에서 사용한다면 일단 data를 이전 데이터에서 가져다가 쓰고, 유효하지 않기 때문에 재요청을 실시해서 대체한다. 만약 5분이 지났다면 data 가 undefined 이고 새로 요청을 실시한다.</li>
</ul>
</li>
<li>axios 인스턴스를 사용하는 이유?<ol>
<li>baseURL을 설정하기 위해서 </li>
<li>공통 헤더를 인스턴에 넣어서 요청할 수 있다.</li>
</ol>
</li>
<li>react-query를 프로젝트에서 사용할 때에는 QueryClientProvider를 최상단에서 감싸줘야 한다. 캐시를 관리할때 사용하는 QueryClient 인스턴스를 자식 컴포넌트에서 사용할수 있게 해주기 때문이다.</li>
<li>데이터를 생성,수정, 삭제 할때는 useMutation 이라는 hook 을 사용한다. → useMutation 은 특정 함수에서 우리가 원하는 때에 직접 요청을 시작하는 형태로 작동한다.</li>
<li>refetch 를 이용하는 방법은 구현하기 쉽지만 모든 페이지에 대해서 재용청 하는 문제가 있다. → useInfiniteQuery 는 반대 방향으로도 페이지네이션 할 수 있는데 그때 사용하는 getPreviousPageParam 을 옵션 설정하여 구현 최적화할 수 있다.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/24/DevOps/Docker/211224-Using%20Node(4)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/24/DevOps/Docker/211224-Using%20Node(4)/" class="post-title-link" itemprop="url">Using Node(4)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-24 12:55:56 / Modified: 12:59:25" itemprop="dateCreated datePublished" datetime="2021-12-24T12:55:56+09:00">2021-12-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Run-your-tests"><a href="#Run-your-tests" class="headerlink" title="Run your tests"></a>Run your tests</h1><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>Node.js 와 Mocha frameworks 를 사용하여 Docker  안에서 Unit test 를 진행하는 방법을 알아본다.</p>
<h2 id="Create-a-test"><a href="#Create-a-test" class="headerlink" title="Create a test"></a>Create a test</h2><p><code>./test</code> 폴더를 application 안에서 생성한다 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p><code>test.js</code> 파일을 <code>./test</code> 폴더 안에 생성한다. </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line">describe(<span class="string">&#x27;Array&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe(<span class="string">&#x27;#indexOf()&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">&#x27;should return -1 when the value is not present&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      assert.equal([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].indexOf(<span class="number">4</span>), -<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Running-locally-and-testing-the-application"><a href="#Running-locally-and-testing-the-application" class="headerlink" title="Running locally and testing the application"></a>Running locally and testing the application</h2><p>Docker image 를 컨테이너 안에서 build 하고 실행시킨다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose -f docker-compose.dev.yml up --build</span><br></pre></td></tr></table></figure>

<h2 id="Install-Mocha"><a href="#Install-Mocha" class="headerlink" title="Install Mocha"></a>Install Mocha</h2><p>개발 의존성으로 Mocha 를 설치한다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev mocha</span><br></pre></td></tr></table></figure>

<h2 id="Update-package-json-and-Dockerfile-to-run-tests"><a href="#Update-package-json-and-Dockerfile-to-run-tests" class="headerlink" title="Update package.json and Dockerfile to run tests"></a>Update package.json and Dockerfile to run tests</h2><p>컨테이너 안에서 test 가 진행될 수 있도록 package.json을 수정하자. 위에서 똑같은 docker run command를 실행시킬건데 이번에는 package.json 에 test 스크립트를 추가하고 test가 실행 될 수 있도록 한다. </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;script&quot;</span>: &#123;</span><br><span class="line">		<span class="attr">&quot;test&quot;</span> : <span class="string">&quot;mocha ./**/*.js&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;start&quot;</span> : <span class="string">&quot;nodemon --inspect=0.0.0.0:9229 server.js&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>test 실행:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose -f docker-compose.dev.yml run notes npm run <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h2 id="Multi-stage-Dockerfile-for-testing"><a href="#Multi-stage-Dockerfile-for-testing" class="headerlink" title="Multi-stage Dockerfile for testing"></a>Multi-stage Dockerfile for testing</h2><p>명령에 따라 테스트를 실행하는 것 외에도 Dockerfile을 사용해서 이미지를 빌드할 때 테스트를 실행할 수 있다. 밑에 Dockerfile 은 test를 진행하고 production image 를 build 한다.</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">14.15</span>.<span class="number">4</span> as base</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> package.json package.json</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> package-lock.json package-lock.json</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> base as test</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm ci</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">&quot;npm&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;test&quot;</span> ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> base as prod</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm ci --production</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">&quot;node&quot;</span>, <span class="string">&quot;server.js&quot;</span> ]</span></span><br></pre></td></tr></table></figure>

<p>먼저 , base image에 라벨을 <code>as base</code> 로 추가한다. build stage 마다 참조할 수 있도록 해준다. docker command 를 입력할 때 <code>--target test</code> 같이 명시해서 build stage를 명시해서 build 할 수 있다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t node-docker --target <span class="built_in">test</span> .</span><br></pre></td></tr></table></figure>

<p>이렇게 하면 test 이미지가 빌드 된다. 이제 test 이미지를 실행해 본다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm -p 8000:8000 node-docker</span><br></pre></td></tr></table></figure>

<p>테스트가 실행 된다. </p>
<p>지금은 build 한다음 run 을 하는 방식을 사용하는데 이렇게 하면 실행하기 위해 2번씩 명령어를 입력해야 한다. Dockerfile 내부에 CMD 를 RUN 으로 바꾸어서 조금 개선할 수 있다. CMD 는 컨테이너에서 이미지를 실행할 때 실행된다. 반면에 RUN 은 이미지를 build 할때 실행 되고 실패하면 중지된다. 수정한 Dockerfile은 다음과 같다. </p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">14.15</span>.<span class="number">4</span> as base</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> package.json package.json</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> package-lock.json package-lock.json</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> base as test</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm ci</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm run <span class="built_in">test</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> base as prod</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm ci --production</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">&quot;node&quot;</span>, <span class="string">&quot;server.js&quot;</span> ]</span></span><br></pre></td></tr></table></figure>

<p>똑같이 build 한다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t node-docker --target <span class="built_in">test</span> .</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/22/DevOps/Docker/211221-Docker%20compose%EB%A1%9C%20%EC%84%9C%EB%B2%84%20%EB%9D%84%EC%9A%B0%EA%B8%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/22/DevOps/Docker/211221-Docker%20compose%EB%A1%9C%20%EC%84%9C%EB%B2%84%20%EB%9D%84%EC%9A%B0%EA%B8%B0/" class="post-title-link" itemprop="url">Docker compose로 서버 띄우기</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-22 20:21:35 / Modified: 20:21:45" itemprop="dateCreated datePublished" datetime="2021-12-22T20:21:35+09:00">2021-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="DockerCompose"><a href="#DockerCompose" class="headerlink" title="DockerCompose"></a>DockerCompose</h1><p>docker compose 사용하면 컨테이너간의 의존성을 파일 하나로 관리하면서 실행시킬 수 있다. 이번시간에는 개발 환경을 직접 docker-compose 로 build 해 보도록 한다.<br>사용하는 이미지는 mysql 과 node 환경을 이용하고 서버 프레임 워크로는 Express 를 사용한다. </p>
<h2 id="docker-compose-dev-yml"><a href="#docker-compose-dev-yml" class="headerlink" title="docker-compose.dev.yml"></a>docker-compose.dev.yml</h2><p>먼저 docker-compose 파일을 생성해준다. 개발 환경임을 명시하기 위해서 dev.yml 파일로 생성한다. docker-compose 파일을 사용하지 않고도 run 명령어로 실행시킬 수 있지만 compose 파일을 사용하면 하나의 파일로 의존성을 관리할 수 있다. </p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  mysqldb:</span><br><span class="line">    image: mysql</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="number">3306</span>:<span class="number">3306</span></span><br><span class="line">    command: <span class="comment"># 명령어 실행</span></span><br><span class="line">      - --character-set-server=utf8mb4</span><br><span class="line">      - --collation-server=utf8mb4_unicode_ci</span><br><span class="line">    volumes:</span><br><span class="line">      - mysql:/var/lib/mysql</span><br><span class="line">      - mysql_config:/etc/mysql</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=<span class="number">1</span>q2w3e</span><br><span class="line">      - MYSQL_DATABASE=test</span><br><span class="line"></span><br><span class="line">  notes:</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysqldb</span><br><span class="line">    build:</span><br><span class="line">      context: .</span><br><span class="line">    working_dir:</span><br><span class="line">      /app</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="number">443</span>:<span class="number">8080</span></span><br><span class="line">      - <span class="number">9229</span>:<span class="number">9229</span></span><br><span class="line">    environment:</span><br><span class="line">      - SERVER_PORT=<span class="number">8080</span></span><br><span class="line">      - DB_PORT=<span class="number">3306</span></span><br><span class="line">      - MYSQL_DATABASE=test</span><br><span class="line">      - <span class="keyword">USER</span>=root</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=<span class="number">1</span>q2w3e</span><br><span class="line">      - HOST=mysqldb</span><br><span class="line">      - CHOKIDAR_USEPOLLING=true</span><br><span class="line">    volumes:</span><br><span class="line">      - ./:/app</span><br><span class="line">    command: </span><br><span class="line">      - bash</span><br><span class="line">      - -c</span><br><span class="line">      - |</span><br><span class="line">        /app/wait-for-it.sh mysqldb:<span class="number">3306</span> -t <span class="number">10</span></span><br><span class="line">        yarn <span class="keyword">run</span><span class="bash"> nodemon-dev</span></span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mysql:</span><br><span class="line">  mysql_config:</span><br></pre></td></tr></table></figure>

<ul>
<li>mysqldb로 서비스를 만들었고, notes 서비스에서 HOST를 mysqldb로 환경 변수를 전달하고 있는데 DNS를 지원하기 때문에 compose 된 환경 안에서 이름 그대로 접근할 수 있다. </li>
<li>notes 에서 build로 context로 현제 폴더를 지정해 주었는데 이렇게 하면 현제 폴더에서 Dockerfile를 참조해서 build를 실행한다. 명시적으로 파일을 지정해 줄 수 도 있다. </li>
<li>depends_on 을 통해서 의존성을 명시한다. 해당 서버에서 mysql 에 test table을 조회하는데 test table이 만들어지 않은 상태에서 접근하려고 하면 에러가 발생한다. 의존성을 명시해서 먼저 mysqldb 에 build 가 실행된 이후에 notes 에 build 가 실행되도록 한다.</li>
<li>다만, depends_op은 실행 순서는 보장해 주지만 준비 상태까지는 보장해 주지 않는다. 따라서 wait-for-it.sh 스크립트를 사용했는데 조금 서치해보면 어떻게 설치하는지 알 수 있다. 그냥 사용하면 권한 거부 에러가 발생하기 대문에 wait-for-it.sh 의 실행 권한을 설정하고 build 해야 한다. </li>
<li>dockerfile로 개발환경을 설정할때에는 현제 로컬에 수정사항을 반영하기 위해서 $(pwd) 같은 것을 사용했었는데 docker-compose 파일을 사용하면 상대 경로를 통해서 수정사항을 반영할 수 있도록 하는게 가능하다. </li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/22/TIL/211221-211221%20%EB%A6%AC%EC%95%A1%ED%8A%B8%20%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/22/TIL/211221-211221%20%EB%A6%AC%EC%95%A1%ED%8A%B8%20%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C/" class="post-title-link" itemprop="url">211221 리액트 네이티브</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-22 20:00:49 / Modified: 20:00:55" itemprop="dateCreated datePublished" datetime="2021-12-22T20:00:49+09:00">2021-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TIL/" itemprop="url" rel="index"><span itemprop="name">TIL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="211221"><a href="#211221" class="headerlink" title="211221"></a>211221</h1><h2 id="리액트-네이티브"><a href="#리액트-네이티브" class="headerlink" title="리액트 네이티브"></a>리액트 네이티브</h2><ul>
<li>커스텀 버튼에서 primary 버튼과 secondary 버튼을 만드는 방법 &lt;429p&gt;</li>
<li>React.forwardRef(CusomComponent) 와 같이 선언하고 CustomComponent에서 원하는 컴포넌트에 props 다음으로 받아온 ref 를 proos로 사용하게 설정하면 사용하는 쪽에서 CustomComponent에 ref를 넘겨줌으로써 CustomComponent 내부의 컴포넌트를 참조 할 수 있다.</li>
<li>스택에 화면을 비워야 한다면? 로그인 했는데 로그인 화면으로 스와이프해서 넘어가는것 방지하는 경우 같은.. reset이라는 메서드가 있는데 번거로움.. 대신에 특정 조건을 만족하면 스택에서 화면을 제거하는 방법으로 구현 가능하고 공식문서에서도 이 방법을 추천함. → rootStack 같은 곳에서 특정 상태를 기반으로(ex. user) 조건부 렌더링으로 스택을 처리하면 됨.</li>
<li>로그인 정보를 유지하기 위해서 일반적으로는 AsyncStorage를 사용한다.</li>
<li>RefreshControl 을 사요하면 FlatList 에서 아래로 내리는 스와이프 동작으로 새로고침을 구현할 수 있다. FlatList 에 refreshControl 컴포넌트로 RefreshControl 을 주입하면 된다.</li>
<li>useNavigationState 함수를 사용해서 내비게이션 상태를 조회할 수 있다.</li>
<li>Pressable 에 hitSlop을 설정하면 컴포넌트 영역은 그대로 유지하고 터치 가능한 영역만 설정한 숫자 만큼 늘려준다. 숫자도 넣을 수 있고, Rect 타입의 객체를 넣을 수 도 있다.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/21/TIL/211216-211216%20%EB%B0%B1%EC%97%94%EB%93%9C(%EC%9D%B8%EC%A6%9D)%20%EB%A6%AC%EC%95%A1%ED%8A%B8%20%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/21/TIL/211216-211216%20%EB%B0%B1%EC%97%94%EB%93%9C(%EC%9D%B8%EC%A6%9D)%20%EB%A6%AC%EC%95%A1%ED%8A%B8%20%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C/" class="post-title-link" itemprop="url">211216 백엔드(인증) 리액트 네이티브</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-21 21:39:28 / Modified: 21:39:46" itemprop="dateCreated datePublished" datetime="2021-12-21T21:39:28+09:00">2021-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TIL/" itemprop="url" rel="index"><span itemprop="name">TIL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="211216"><a href="#211216" class="headerlink" title="211216"></a>211216</h1><h2 id="백엔드-Authentication"><a href="#백엔드-Authentication" class="headerlink" title="백엔드-Authentication"></a>백엔드-Authentication</h2><ul>
<li>인증이란? : you are who you say you are, 다양한 방법으로 인증 가능하다 통상적으로 password, id 로<ul>
<li>먼저 회원가입을 진행해서 서버에 id, passwrod 를 저장한다.</li>
<li>클라이언트는 로그인 할때 회원가입한  id, password를 서버에 전송한다.</li>
<li>어떻게 로그인 상태를 유지할 수 있을까?</li>
</ul>
</li>
<li>세션과 쿠기 (서버에서 사용할 수 있는 전통적인 옵션- 어떻게 로그인 상태를 유지할지에 대한 방법)<ol>
<li>세션 <ul>
<li>서버에서 확인후 세션을 만든다 (userId, sessiontId, expiration) - Session DB에 저장 or 파일시스템이나 메모리도 될 수 있음</li>
<li>쿠키에 HTTP Only로 sessiontId 정보를 전달함.</li>
<li>다음 요청때마다 쿠키 정보를 전달해줌</li>
<li>장점 : 브라우저에 전달만 하면 되서 간단하고, sessionId 만 전달하면되서 사용자의 정보를 전달하지 않아도 된다. HTTP Only를 사용하면 스크립트로 못읽기 때문에 보안상의 이점도 있다.</li>
<li>단점 : Stateful 하기 때문에 다양한 서버들이 SettionDb를 읽어야 하고 많은 요청이 들어오게 된다. 내부적으로 네트워킹이 많아짐. 성능 하락</li>
</ul>
</li>
<li>JWT (Json Web Token)<ul>
<li>다음과 같은 정보를 JSON으로 만들고 토큰화해서 보낸다. header, payload, signature, 모든 정보는 인코딩해서 보내고 서버에서 secrete으로 사용하는 키도 인코딩해서 signature에 포함해서 보낸다.</li>
<li>로그인 하면, 로그인 정보 + 만료 시간 등등 합쳐서 JWT를 만듦.</li>
<li>클라이언트는 Header를 이용하여 모든 request마다 JWT를 포함해서 전달해 줌.</li>
<li>서버는 JWT를 검증한 후에 데이터를 반환함.</li>
<li>장점 : 서버에 State가 없다. 서버를 확장하거나 분산하기에 용이하다.</li>
<li>단점 : JWT 자체가 단점이 될 수 있다. → 계속 JWT를 주고 받아야 한다. 만약 영원히 만료되지 않은 JWT를 헤커가 탈취한다면.. 사용할때 보안에 신경써야 한다.</li>
</ul>
</li>
</ol>
</li>
<li>bcrypt 란?  : 사용자 정보를 그대로 저장하는 것이 아니라 암호화 해서 저장하기 위해 사용함. → 암호화만 가능한데 (암호화 한것을 비교하는 것), salt 가 없다면 경우의 수로 암호화 해 보면서 유추할 수 있어서 salt를 포함하여 경우의 수를 늘림. 10~12 정도로 설정. 길어지면 cpu 부하 심해짐..</li>
<li>JWT, 32 시크릿 키로 권고 됨. 한번 발행된 토근은 변경되면 안된다. → 만약 한버이라도 변경 한다면 최종적으로 붙은 signature도 변경되어서 verify시 오류 발생하고 누군가 변경한 토큰인지 확인 가능하다.<ul>
<li>만료될 수 있도록 만들어야 한다. → option으로 전달함. {expiresIn: 2} 이런식으로 → 2초 후에 만료</li>
</ul>
</li>
</ul>
<h2 id="리액트-네이티브"><a href="#리액트-네이티브" class="headerlink" title="리액트 네이티브"></a>리액트 네이티브</h2><ul>
<li>Platform.OS 로 플랫폼 종류를 알 수 있다.</li>
<li>KeyboardAvoidingView 에서 behavior Props 로 동작 장식을 정의할 수 있다.<ul>
<li>padding : 키보드 열렸을때 뷰 하단에 패딩을 설정</li>
<li>height: 뷰의 높이 자체를 변경</li>
<li>position:  뷰의 위치를 설정</li>
</ul>
</li>
<li>Platform.select({ios:, android,}) 를 사용해서 플랫폼 별로 옵션을 줄 수 있다.</li>
<li>터치 했을때 효과 주기<ul>
<li>TouchableHighlight: 터치했을 대 배경색 변경</li>
<li>TouchableNativeFeedback: 안드로이드에서 물결 효과 ios에서는 오류</li>
<li>ToucableOpacity: 투명도 조정</li>
<li>ToucableWithoutFeedback: 아무 효과도 적용하지 않는다.</li>
</ul>
</li>
<li>keyboard.dismiss() 는 현제 나타난 키보드를 닫는다.</li>
<li>onSubmitEditing → enter 눌렀을때 이벤트</li>
<li>returnkeyType=”done” → 키보드 눌렀을대 return 타입을 보여줌.</li>
<li>FlatList에 ItemSeparatorComponent Props를 지정해서 컴포넌트 사이에 구분선을 설정할 수 있다.</li>
<li>react-nativevector-icons 를 사용하면 벡터 아이콘을 리액트 네이티브 프로젝트에서 간편하게 컴포넌트처럼 사용할 수 있게 해준다.</li>
<li>ios/proejctForderName/info.plist → 앱의 이름, 아이콘, 버전 등 앱에서 필요한 설정값을 지니고 있다.</li>
<li>android/app/build.gradle → 프로젝트의 의존성, 프로그인 및 빌드에 필요한 설정에 대한 정보를 지니고 있다.</li>
<li>Alert.aler(제목, 내용, 버튼, 옵션) 버튼 부분에 {text, onPress, style} 을 각각 설정해서 버튼 스타일 내용, 눌렀을때 동작등을 정의할수 있다. 안드로이드에서는 버튼 스타일이 적용되지 않아서 따로 만들어야 한다. 설정할 수 있는 style은 다음과 같다.<ul>
<li>cancel: 취소 기본에 폰트 두껍게</li>
<li>default: 기본 파란색</li>
<li>destructive: 파괴적인? 삭제하는 상황에 적합 빨간색이 됨.</li>
</ul>
</li>
<li>옵션으로는 바깥에 눌렀을때 동작이나, 안드로이드에서는 바깥에 눌렀을때 취소 옵션 같은걸 줄 수 있다.</li>
<li>브라우저에 localStorage 와 비슷한 AsyncStorage 를 사용할 수 있다. API도 비슷한데 다른점이라면 AsyncStorage는 비동기로 동작해서 Promise를 반환한다. <code>yarn add @react-native-community/async-strage</code> 로 설치한다.</li>
<li>useEffect 에는 cleanup 하는 기능이 있는데 내부 함수가 promise를 반환하면 충돌하기 때문에 내부에서 async 함수를 선언한 후에 호출하는 방법을 사용한다.</li>
<li>AsyncStorage를 사용할때는 추상화 해서 사용하는 것을 추천한다 → 나중에 다른 스토리지를 사용할때 쉽게 교체할 수 있도록</li>
<li>android 는 AsyncStorage 로 6MB를 저장할 수 있다 늘리려면 gradle.properties를 수정한다. ios 는 따로 최대 용량이 설정되어 있지 않다.</li>
<li>AsyncStorage는 데이터가 많아지면 성능이 떨어진다. 또한 정렬이나 인덱싱 기능을 지원하지 않는다. 소규모에서 적합하고 조금 규모가 커지면 대안으로 <code>react-native-sqlite-storage</code> 같은것을 사용하면 된다.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/21/TIL/211221-211221%20%EB%A6%AC%EC%95%A1%ED%8A%B8%20%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C,%20%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/21/TIL/211221-211221%20%EB%A6%AC%EC%95%A1%ED%8A%B8%20%EB%84%A4%EC%9D%B4%ED%8B%B0%EB%B8%8C,%20%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/" class="post-title-link" itemprop="url">211221 리액트 네이티브, 알고리즘</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-21 21:39:28 / Modified: 21:39:46" itemprop="dateCreated datePublished" datetime="2021-12-21T21:39:28+09:00">2021-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TIL/" itemprop="url" rel="index"><span itemprop="name">TIL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="211221"><a href="#211221" class="headerlink" title="211221"></a>211221</h1><h2 id="리액트-네이티브"><a href="#리액트-네이티브" class="headerlink" title="리액트 네이티브"></a>리액트 네이티브</h2><h3 id="네비게이션"><a href="#네비게이션" class="headerlink" title="네비게이션"></a>네비게이션</h3><ul>
<li>네비게이션을 위해서 @react-navigation/native 를 사용한다. 의존하는 라이브러리로 react-native-screens react-native-safe-area-context 를 설치한다.</li>
<li>브라우저에 history 와 같은 기능을 사용하기 위해서 Native Stack Navigator 를 사용한다. 설치 @react-navigation/native-stack</li>
<li>스크린을 사용되는 컴포넌트는 navigation을 props로 받음. navigation.navigate 나 navigation.push 로 화면 전환을 할 수 있다.</li>
<li>마찬가지로 props로 route도 받아온다. route는 key, name, params 를 갖는다.</li>
<li>navigate 와 push 에 차이는 navigate 는 전환 화면이 현제 화면과 다르면 화면을 쌓지 않고, push 는 다른 화면을 쌓는다.</li>
<li>뒤로가기 navigation.pop( ) 으로 하고, 가장 처음 화면으로 이동할 때에는 navigation.popToTop() 으로 이동한다.</li>
<li>드로어 네비게이터를 사용하려면 @react-navigation/drawer react-native-gesture-handler react-native-reanimated 를 설치한다</li>
<li>Screen 이 아닌 곳에서는 React와 마찬가지로 hook을 통해 route 와 navigationd 을 가져올  수 있다. <code>useNavigation</code> , <code>useRoute</code></li>
<li><code>useFocusEffect</code> 웹과 달리 앱은 화면이 사라지는 것이 아니라 쌓게 된다. 따라서 Home 면에서 Detail 화면으로 넘어갈때 화면을 쌓일 뿐이여서 componentWillUnmount 같은 로직이 호출되지 않는다. 마찬가지로 Detail 에서 Home으로 돌아올 때도 componentDidMount 같은 로직이 호출되지 않는다. 그래서 만약 다른 화면을 봤다가 다시 돌아왔을때 어떤 작업을 하려면 <code>useFocusEffect</code> hook 을 사용해야 한다. → 반드시 <code>useCallback</code> 과 같이 사용해야 한다. 안그러면 렌더링 될때마마다 useFocusEffect 에 등록한 함수가 실행된다.</li>
</ul>
<h2 id="알고리즘"><a href="#알고리즘" class="headerlink" title="알고리즘"></a>알고리즘</h2><ul>
<li>DP 와 분활정복의 차이 ?<ul>
<li>큰문제가 작은 문제로 나누어짐, 가장 큰 차이점은 부분 문제의 중복이다. DP 는 부분 문제의 중복이 존재하고, 분할정복은 그렇지 않다.</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/21/DevOps/Docker/211221-Docker%20tutorial(3)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/21/DevOps/Docker/211221-Docker%20tutorial(3)/" class="post-title-link" itemprop="url">Docker tutorial(3)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-21 21:34:27 / Modified: 21:34:44" itemprop="dateCreated datePublished" datetime="2021-12-21T21:34:27+09:00">2021-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Update-the-source-code"><a href="#Update-the-source-code" class="headerlink" title="Update the source code"></a>Update the source code</h1><p>코드를 업데이트하고 적용하는 방법을 알아본다.</p>
<ol>
<li>코드를 고친다. </li>
<li>build 할때 사용했던 명령어를 똑같이 입력한다. </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t getting-started .</span><br></pre></td></tr></table></figure>

<ol>
<li>업데이트된 코드를 사용해서 새로운 컨테이너를 시작한다.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -db 3000:3000 getting-started</span><br></pre></td></tr></table></figure>

<p>하지만 에러가 발생한다.. (docker: Error response from daemon: driver failed….)</p>
<p>왜냐하면 이미 3000 번 포트로 전에 컨테이너가 실행중이기 때문이다. 하나의 머신에 특정한 포트는 한게만 실행 실행시킬 수 있다. 오래된 컨테이너를 지워야 한다.</p>
<h2 id="Replace-the-old-container"><a href="#Replace-the-old-container" class="headerlink" title="Replace the old container"></a>Replace the old container</h2><p>컨테이너를 지우기 위해서는 컨테이너 실행을 중지 시켜야 한다. 두가지 방법이 있는데 편한것을 선택하면 된다. </p>
<h3 id="Remove-a-container-using-the-CLI"><a href="#Remove-a-container-using-the-CLI" class="headerlink" title="Remove a container using the CLI"></a>Remove a container using the CLI</h3><ol>
<li>컨테이너의 ID를 얻는다. </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br></pre></td></tr></table></figure>

<ol>
<li>docker ID 혹은 이름을 사용해서 컨테이너를 멈춘다.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop &lt;the-container-id or name&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>컨테이너가 멈추면 <code>docker rm</code> 커멘드로 지울 수 있다. </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm &lt;the-container-id or name&gt;</span><br></pre></td></tr></table></figure>

<p>-f 플래그를 이요해서 실행중인 중에도 삭제할 수 있다. <code>docker rm -f &lt;the-continaer-id or name&gt;</code> </p>
<h3 id="Docker-Dashboard"><a href="#Docker-Dashboard" class="headerlink" title="Docker Dashboard"></a>Docker Dashboard</h3><p>Docker Dashboard에서 실행중인 컨테이널르 확인하고 쓰레기통 아이콘을 누르면 삭제할 수 있다. </p>
<h3 id="Start-the-updated-app-container"><a href="#Start-the-updated-app-container" class="headerlink" title="Start the updated app container"></a>Start the updated app container</h3><ol>
<li>앱을 실행시킨다. </li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dp 3000:3000 getting-started</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/21/DevOps/Docker/211221-Using%20Node(3)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/21/DevOps/Docker/211221-Using%20Node(3)/" class="post-title-link" itemprop="url">Using Node(3)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-21 21:34:27 / Modified: 21:34:44" itemprop="dateCreated datePublished" datetime="2021-12-21T21:34:27+09:00">2021-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="develop-app"><a href="#develop-app" class="headerlink" title="develop app"></a>develop app</h1><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>이전 섹션에서 구축한 애플리케이션을 위한 로컬 개발 환경을 설정하는 과정을 살펴본다.</p>
<h2 id="Local-database-and-containers"><a href="#Local-database-and-containers" class="headerlink" title="Local database and containers"></a>Local database and containers</h2><p>이번 섹션에서는 MongoDB를 사용한다. MongoDB를 직접 다운로드 하는것 대신에 Docker 공식 이미지를 사용하도록 한다. </p>
<p>MongoDB Container 를 실행하기 전에 Data를 저장할 수 있는 볼륨을 설정한다. Docker 가 제공하는 volumes 기능을 사용한다.</p>
<p>data와 MongoDB 설정 볼륨을 만든다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume create mongodb</span><br><span class="line">$ docker volume create mongodb_config</span><br></pre></td></tr></table></figure>

<p>애플케이션과 database가 소통할 네트워크를 생성한다. 네트워크는 사용자 정의 브리지 네트워크라고 하며 컨테이너간 소통할때 사용할 수 있는 DNS 조회 서비스를 제공한다. (mongodb 로 접속할 수 있게 DNS 제공)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create mongodb</span><br></pre></td></tr></table></figure>

<p>이제 컨테이너에서 mongoDB를 실행하고 볼륨과 네트워크를 연결한다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm -d -v mongodb:/data/db \</span><br><span class="line">	-v mongodb_config:/data/configdb -p 21017:21017 \</span><br><span class="line">	--network mongodb \</span><br><span class="line">	--name mongodb \</span><br><span class="line">mongo</span><br></pre></td></tr></table></figure>

<p><code>server.js</code> 를 수정해서 mongoDB를 사용하도록 한다. <code>process.env.CONNECTIONSTRING</code> 과 같이 환경 변수를 조회하고 있는데 나중에 컨테이너를 실행시킬때 <code>CONNECTIONSTRING</code> 이라는 이름에 환경변수를 추가할 수 있다. </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ronin     = <span class="built_in">require</span>( <span class="string">&#x27;ronin-server&#x27;</span> )</span><br><span class="line"><span class="keyword">const</span> mocks     = <span class="built_in">require</span>( <span class="string">&#x27;ronin-mocks&#x27;</span> )</span><br><span class="line"><span class="keyword">const</span> database  = <span class="built_in">require</span>( <span class="string">&#x27;ronin-database&#x27;</span> )</span><br><span class="line"><span class="keyword">const</span> server = ronin.server()</span><br><span class="line"></span><br><span class="line">database.connect( process.env.CONNECTIONSTRING )</span><br><span class="line">server.use( <span class="string">&#x27;/&#x27;</span>, mocks.server( server.Router(), <span class="literal">false</span>, <span class="literal">false</span> ) )</span><br><span class="line">server.start()</span><br></pre></td></tr></table></figure>

<p><code>ronin-database</code> 를 추가했으므로 설치한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i ronin-database</span><br></pre></td></tr></table></figure>

<p>build 한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --tag node-docker .</span><br></pre></td></tr></table></figure>

<p>컨테이너를 실행시킨다. 여기서 <code>CONNECTIONSTRING</code> 환경변수를 추가해서 애플리케이션이 어떻게 데이터베이스에 접근해야 하는지 알려준다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run \</span><br><span class="line">  -it --rm -d \</span><br><span class="line">  --network mongodb \</span><br><span class="line">  --name rest-server \</span><br><span class="line">  -p 8000:8000 \</span><br><span class="line">  -e CONNECTIONSTRING=mongodb://mongodb:27017/yoda_notes \</span><br><span class="line">  node-docker</span><br></pre></td></tr></table></figure>

<h2 id="Use-Compose-to-develop-locally"><a href="#Use-Compose-to-develop-locally" class="headerlink" title="Use Compose to develop locally"></a>Use Compose to develop locally</h2><p>하나의 명령으로 node-docker 와 MongoDB를 시작하는 Compose 파일을 생성해 본다. 또한 컴포즈 파일로 node-docker 를 시작할때 debug mode로 시작하게 해서 실행중인 프로세스에 디버거를 연결할 수 도 있다. </p>
<p><code>docker-compose.dev.yml</code> 파일을 만들어서 다음 내용을 복사한다. </p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"> notes:</span><br><span class="line">  build:</span><br><span class="line">   context: .</span><br><span class="line">  ports:</span><br><span class="line">   - <span class="number">8000</span>:<span class="number">8000</span></span><br><span class="line">   - <span class="number">9229</span>:<span class="number">9229</span></span><br><span class="line">  environment:</span><br><span class="line">   - SERVER_PORT=<span class="number">8000</span></span><br><span class="line">   - CONNECTIONSTRING=mongodb://mongo:<span class="number">27017</span>/notes</span><br><span class="line">  volumes:</span><br><span class="line">   - ./:/app</span><br><span class="line">  command: npm <span class="keyword">run</span><span class="bash"> debug</span></span><br><span class="line"></span><br><span class="line"> mongo:</span><br><span class="line">  image: mongo:<span class="number">4.2</span>.<span class="number">8</span></span><br><span class="line">  ports:</span><br><span class="line">   - <span class="number">27017</span>:<span class="number">27017</span></span><br><span class="line">  volumes:</span><br><span class="line">   - mongodb:/data/db</span><br><span class="line">   - mongodb_config:/data/configdb</span><br><span class="line">volumes:</span><br><span class="line"> mongodb:</span><br><span class="line"> mongodb_config:</span><br></pre></td></tr></table></figure>

<p>compose 파일을 이용하면 docker run 할때 사용했던 여러가지 파라미터를 컴포즈 파일에 명시함으로써 생략할 수 있다.</p>
<ul>
<li>디버거를 연결할 수 있는 9229 포트를 노출한다.</li>
<li>services 에서 설정한 이름을 서비스에서 설정할 수 있다. 이경우에는 <code>mongo</code> 가 된다.</li>
<li>디버거 모드로 실행하기 위해서 <code>package.json</code> 에 스크립트를 추가한다.</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;debug&quot;</span> : <span class="string">&quot;nodemon --inspect=0.0.0.0:9229 server.js&quot;</span></span><br></pre></td></tr></table></figure>

<p>nodemon을 사용함으로 nodemon을 설치한다 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i nodemon </span><br></pre></td></tr></table></figure>

<p>애플리케이션을 시작한다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose -f docker-compose.dev.yml up --build</span><br></pre></td></tr></table></figure>

<p>docker 이미지를 컴파일한 다음 시작하도록 —build 플래그를 전달한다. </p>
<p>디버깅 모드로도 실행되고 8000 번 포트로 접근할 수 도 있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl --request GET --url http://localhost:8000/notes</span><br></pre></td></tr></table></figure>

<h2 id="Connect-a-debugger"><a href="#Connect-a-debugger" class="headerlink" title="Connect a debugger"></a>Connect a debugger</h2><p>크롬 브라우저와 함께 제공되는 디버거를 사용할 수 있다. 크롬을 열고 주소창에 <code>about:inspect</code> 를 입력한다.</p>
<h2 id="depends-on"><a href="#depends-on" class="headerlink" title="depends_on"></a>depends_on</h2><p>어떤 컨테이너는 다른 컨테이너의 의존해서 실행 순서가 나중이어야 하는 경우가 있다. mysql을 사용하면서 특정 테이블이 생성되기 전에 server에서 접근하면 에러가 발생하는데 이런경우 mysql 컨테이너가 테이블을 만드는 시점보다 server 가 실행되는 시점이 더 빠르기 때문이다. 의존성을 추가하고 싶다면 <code>depends_on</code> 을 사용하여 의존성을 명시해준다. </p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  notes:</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysqldb</span><br><span class="line">    build:</span><br><span class="line">      context: .</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="number">443</span>:<span class="number">8080</span></span><br><span class="line">      - <span class="number">9229</span>:<span class="number">9229</span></span><br><span class="line">    environment:</span><br><span class="line">      - SERVER_PORT=<span class="number">8080</span></span><br><span class="line">      - DB_PORT=<span class="number">3306</span></span><br><span class="line">      - MYSQL_DATABASE=test</span><br><span class="line">      - <span class="keyword">USER</span>=root</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=<span class="number">1</span>q2w3e</span><br><span class="line">      - HOST=mysqldb</span><br><span class="line">    volumes:</span><br><span class="line">      - ./:/app</span><br><span class="line">    command: yarn <span class="keyword">run</span><span class="bash"> debug</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://jayoonkoo.github.io/2021/12/17/DevOps/Docker/211216-Using%20Node(2)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JayoonKoo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="티끌모아 태산">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/17/DevOps/Docker/211216-Using%20Node(2)/" class="post-title-link" itemprop="url">Using Node(2)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-17 13:25:07" itemprop="dateCreated datePublished" datetime="2021-12-17T13:25:07+09:00">2021-12-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-12-21 21:34:00" itemprop="dateModified" datetime="2021-12-21T21:34:00+09:00">2021-12-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Run-Containers"><a href="#Run-Containers" class="headerlink" title="Run Containers"></a>Run Containers</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>컨테이너는 host 와는 격리된 자기 자신만의 파일시스템, 네트워크 프로세스를 가지고 있다. 저번 시간에 이어서 이미지를 실행 보도록 한다,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run node-docker</span><br></pre></td></tr></table></figure>

<p>하지만 이렇게 하면 요청이 거부 된다는 결과만 나온다. 이유는 docker 컨테이너는 host 와 격리되어 있기 때문이다. 따라서 포트를 매핑 시켜야 제대로 실행시킬 수 있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --publish 8080:8080 node-docker</span><br></pre></td></tr></table></figure>

<p>-p 로 축약해서 사용 가능하다.</p>
<h2 id="Run-in-detached-mode"><a href="#Run-in-detached-mode" class="headerlink" title="Run in detached mode"></a>Run in detached mode</h2><p>detached모드로 백그라운드에서 실행시킬수도 있다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ocker run -d -p 8080:8080 node-docker</span><br></pre></td></tr></table></figure>

<p>-d 와 -p 옵션을 합쳐서 -dp로 사용 가능하다. </p>
<h2 id="List-containers"><a href="#List-containers" class="headerlink" title="List containers"></a>List containers</h2><p>현제 실행되고 컨테이너 갯수와 어떤 컨네이너가 실행되어 있는지는 <code>docker ps</code> 로 확인할 수 있다.</p>
<p><code>docker stop</code> 으로 컨테이너 id 나 이름을 주어서 컨테이너를 종료시킬 수 있다.</p>
<h2 id="Stop-start-and-name-containers"><a href="#Stop-start-and-name-containers" class="headerlink" title="Stop, start, and name containers"></a>Stop, start, and name containers</h2><p><code>docker ps</code> 에 기본값은 실행중인 컨테이너를 보여주는 것이다. <code>docker ps -a</code> 플래그를 넣어주면 모든 컨테이너 상태를 볼 수 있다. </p>
<ul>
<li><code>docker restart</code> 에 아이디나 종료된 컨테이너의 이름을 넣어주면 도커 컨테이너를 재실행 시킬 수 있다. restart 를 실행하면 처음 실행할 때 사용했던 플래그나 커맨드를 똑같이 사용한다.</li>
</ul>
<p>이제 컨테이너의 이름이 랜덤으로 바뀌는 이슈를 고쳐 보자. 컨테이너 이미지를 기본적으로 실행하면 랜덤한 이름이 정해진다.</p>
<p>기존에 실행해서 랜덤하게 생성되었던 컨테이너를 지운다. </p>
<ul>
<li><code>docker rm &lt;컨테이너 이름&gt;</code></li>
</ul>
<p>여러 이름을 한꺼번에 넣을 수 도 있다.</p>
<p>이제 컨테이너의 이름을 랜덤이 아닌 정해진 것으로 설정해 보자. 개발할때 변수에 이름을 짖는것처럼 식별하기 쉽고 읽기 쉽게 정하는 것이 좋다. 이름을 설정하기 위해서는 단순히 —name 플래그를 더해주기만 하면 된다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dp 8080:8080 --name naver-api node-docker</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JayoonKoo</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
